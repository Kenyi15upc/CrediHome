﻿<div class="container mt-4">
  <!-- Título dinámico -->
  <div *ngIf="!isLoading">
    <h2 *ngIf="isEditMode"><i class="bi bi-person-circle"></i> Mi Perfil de Cliente</h2>
    <h2 *ngIf="!isEditMode"><i class="bi bi-person-plus-fill"></i> Completa tu Perfil</h2>
    <p *ngIf="isEditMode">Aquí puedes ver y actualizar tu información socioeconómica.</p>
    <p *ngIf="!isEditMode">Para continuar, por favor completa tus datos. Esta información nos ayudará a ofrecerte las mejores simulaciones.</p>
  </div>
  <hr>

  <div class="card shadow-sm">
    <div class="card-body">
      <!-- Mensaje de Carga -->
      <div *ngIf="isLoading" class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p>Buscando tu información...</p>
      </div>

      <!-- Mensajes de Feedback -->
      <div *ngIf="successMessage" class="alert alert-success">
        {{ successMessage }}
      </div>
      <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>

      <!-- Formulario de Datos del Cliente (Crear o Actualizar) -->
      <form *ngIf="!isLoading" [formGroup]="clienteForm" (ngSubmit)="onSubmit()">
        <!-- Fila de Nombre y Apellidos -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="nombre" class="form-label">Nombres <span class="text-danger">*</span></label>
            <input type="text" id="nombre" class="form-control" formControlName="nombre" placeholder="Ej: Juan Carlos">
          </div>
          <div class="col-md-6">
            <label for="apellidos" class="form-label">Apellidos</label>
            <input type="text" id="apellidos" class="form-control" formControlName="apellidos" placeholder="Ej: García Pérez">
          </div>
        </div>

        <!-- Fila de DNI y Teléfono -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="dni" class="form-label">DNI <span class="text-danger">*</span></label>
            <input type="text" id="dni" class="form-control" formControlName="dni" placeholder="12345678" maxlength="8">
          </div>
          <div class="col-md-6">
            <label for="telefono" class="form-label">Teléfono</label>
            <input type="tel" id="telefono" class="form-control" formControlName="telefono" placeholder="987654321" maxlength="9">
          </div>
        </div>

        <!-- Fila de Email y Correo -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" class="form-control" formControlName="email" placeholder="usuario@ejemplo.com">
          </div>
          <div class="col-md-6">
            <label for="correo" class="form-label">Correo Alternativo</label>
            <input type="email" id="correo" class="form-control" formControlName="correo" placeholder="correo@ejemplo.com">
          </div>
        </div>

        <!-- Dirección -->
        <div class="mb-3">
          <label for="direccion" class="form-label">Dirección</label>
          <input type="text" id="direccion" class="form-control" formControlName="direccion" placeholder="Av. Principal 123, Lima">
        </div>

        <!-- Fila de Ocupación -->
        <div class="mb-3">
          <label for="ocupacion" class="form-label">Ocupación</label>
          <input type="text" id="ocupacion" class="form-control" formControlName="ocupacion" placeholder="Ej: Ingeniero de Sistemas">
        </div>

        <!-- Fila de Ingresos y Gastos -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="ingresoMensual" class="form-label">Ingreso Mensual (S/)</label>
            <input type="number" id="ingresoMensual" class="form-control" formControlName="ingresoMensual" placeholder="3000.00" step="0.01">
          </div>
          <div class="col-md-6">
            <label for="gastoMensual" class="form-label">Gasto Mensual (S/)</label>
            <input type="number" id="gastoMensual" class="form-control" formControlName="gastoMensual" placeholder="1500.00" step="0.01">
          </div>
        </div>

        <!-- Botón dinámico -->
        <div class="d-grid gap-2">
          <button *ngIf="isEditMode" type="submit" class="btn btn-primary btn-lg" [disabled]="clienteForm.invalid || !clienteForm.dirty">
            <i class="bi bi-save-fill"></i> Actualizar Información
          </button>
          <button *ngIf="!isEditMode" type="submit" class="btn btn-success btn-lg" [disabled]="clienteForm.invalid">
            <i class="bi bi-check-circle-fill"></i> Crear Mi Perfil
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Sección del Simulador de Créditos (solo si el perfil ya existe) -->
  <div *ngIf="isEditMode && cliente" class="mt-4">
    <div class="card shadow-sm">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0"><i class="bi bi-calculator"></i> Simulador de Crédito Hipotecario</h4>
      </div>
      <div class="card-body">
        <p class="text-muted">
          Simula tu crédito hipotecario con el Método Francés. Ingresa los datos de tu préstamo para calcular las cuotas mensuales, VAN, TIR y otros indicadores financieros.
        </p>

        <form [formGroup]="creditoForm" (ngSubmit)="simularCredito()">
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="moneda" class="form-label">Moneda <span class="text-danger">*</span></label>
              <select id="moneda" class="form-select" formControlName="moneda">
                <option value="SOLES">Soles (S/)</option>
                <option value="DOLARES">Dólares ($)</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="monto" class="form-label">Monto del Préstamo <span class="text-danger">*</span></label>
              <input type="number" id="monto" class="form-control" formControlName="monto" placeholder="150000">
            </div>
            <div class="col-md-4">
              <label for="plazo" class="form-label">Plazo (meses) <span class="text-danger">*</span></label>
              <input type="number" id="plazo" class="form-control" formControlName="plazo" placeholder="240">
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-4">
              <label for="tasaInteres" class="form-label">Tasa de Interés (%) <span class="text-danger">*</span></label>
              <input type="number" id="tasaInteres" class="form-control" formControlName="tasaInteres" placeholder="8.5" step="0.01">
            </div>
            <div class="col-md-4">
              <label for="tipoTasa" class="form-label">Tipo de Tasa <span class="text-danger">*</span></label>
              <select id="tipoTasa" class="form-select" formControlName="tipoTasa">
                <option value="EFECTIVA">Efectiva</option>
                <option value="NOMINAL">Nominal</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="capitalizacion" class="form-label">Capitalización <span class="text-danger">*</span></label>
              <select id="capitalizacion" class="form-select" formControlName="capitalizacion">
                <option value="MENSUAL">Mensual</option>
                <option value="TRIMESTRAL">Trimestral</option>
                <option value="SEMESTRAL">Semestral</option>
                <option value="ANUAL">Anual</option>
              </select>
            </div>
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-primary btn-lg" [disabled]="creditoForm.invalid">
              <i class="bi bi-calculator-fill"></i> Simular Crédito
            </button>
          </div>
        </form>

        <!-- Resultado de la simulación -->
        <div *ngIf="resultadoSimulacion" class="mt-4 alert alert-info">
          <h5><i class="bi bi-info-circle"></i> Resultado de la Simulación</h5>
          <p><strong>Cuota Mensual:</strong> {{ resultadoSimulacion.cuotaMensual | currency:'S/ ' }}</p>
          <p><strong>Total a Pagar:</strong> {{ resultadoSimulacion.totalPagar | currency:'S/ ' }}</p>
          <p><strong>Total Intereses:</strong> {{ resultadoSimulacion.totalIntereses | currency:'S/ ' }}</p>
          <p class="mb-0 text-muted">
            <em>Nota: Esta es una simulación referencial. Para más detalles, consulta con un asesor.</em>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
